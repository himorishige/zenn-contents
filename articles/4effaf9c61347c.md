---
title: "AWS Amplifyã®Reactå‘ã‘ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’TypeScriptåŒ–ã—ãªãŒã‚‰ä½“é¨“ã—ã¦ã¿ãŸ"
emoji: "ğŸ™Š"
type: "tech"
topics: ["react", "typescript", "amplify"]
published: true
---

# ã¯ã˜ã‚ã«

ä»Šå›ã¯æ•°ã‚ã‚‹AWSã‚µãƒ¼ãƒ“ã‚¹ã®ä¸­ã§ã‚‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒæ‰±ã†ã«ã¨ã¦ã‚‚ä¾¿åˆ©ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹Amplifyã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’è©¦ã—ã¦ã¿ã‚‹ã¤ã„ã§ã«TypeScriptåŒ–ã€Hookséƒ¨åˆ†ã‚’ReduxåŒ–ã—ãªãŒã‚‰é€²ã‚ã¦ã¿ã¾ã™ã€‚

# AWS Amplifyã¨ã¯

ä»Šå›ã¯æ•°ã‚ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸­ã§ã‚‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒæ‰±ã†ã«ã¨ã¦ã‚‚ä¾¿åˆ©ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹Amplifyã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’è©¦ã—ã¦ã¿ã¾ã™ã€‚AWS Amplifyã¯ã€ã²ã¨ã¤ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¨ã„ã†ã‚ã‘ã§ã¯ãªãã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¿…è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’è¤‡åˆçš„ã«æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ã‚ˆã†ãªã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚APIã‚„èªè¨¼ã€CDNã€ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãªã©ãªã©ã‚³ãƒãƒ³ãƒ‰ã‚„Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ç°¡å˜ã«æ©Ÿèƒ½è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãŠãã‚ã—ãä¾¿åˆ©ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

GitHubã¨é€£æºã™ã‚‹ã“ã¨ã§CI/CDã¾ã§å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦ã¯Amplifyã¨ãã®ä»˜éšã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ãˆã‚Œã°ç”Ÿãã¦ã„ã‘ã‚‹ã®ã§ã¯ï¼ï¼Ÿãã‚‰ã„ã®ã‚µãƒ¼ãƒ“ã‚¹ãªã®ã§ã¯ã¨å€‹äººçš„ã«ã¯æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

ãã‚“ãªAmplifyã«ã‚‚ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨åŒã˜ç”¨ã«ã„ã‚ã„ã‚ãªè¨€èªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãŒã‚ã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯Reactã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’TypeScriptã«ç½®ãæ›ãˆãªãŒã‚‰å‹‰å¼·ã—ã¦ã¿ã¾ã—ãŸã€‚

https://docs.amplify.aws/start/q/integration/react

# ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

TypeScriptã«ç½®ãæ›ãˆã‚‹ã¨ã„ã£ã¦ã‚‚ã»ã¨ã‚“ã©ã¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã¾ã¾é€²ã‚ã¦ã„ãã“ã¨ã§ã‚ã£ã¨ã„ã†é–“ã«èªè¨¼æ©Ÿèƒ½ä»˜ãTodoã‚¢ãƒ—ãƒªãŒå‡ºæ¥ä¸ŠãŒã£ã¦ã—ã¾ã„ã¾ã™ğŸ™ˆ

TypeScriptã¨å¾Œã»ã©Hookséƒ¨åˆ†ã‚’Reduxã«ç½®ãæ›ãˆãŸã‹ã£ãŸã®ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«`redux-typescript`ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚

```bash
$ yarn create react-app project-name --template redux-typescript
```

ä»–ã«ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®é …ç›®ã¨è‹¥å¹²ç•°ãªã‚‹ã®ã¯ã“ã®éƒ¨åˆ†ãã‚‰ã„ã§ã—ã‚‡ã†ã‹ã€‚

[Create a GraphQL API and database](https://docs.amplify.aws/start/getting-started/data-model/q/integration/react#create-a-graphql-api-and-database)

```bash
? Do you want to generate code for your newly created GraphQL API Yes
? Choose the code generation language target typescript // ã“ã“ã§TypeScriptã‚’é¸ã¶ã“ã¨ã§ä»¥å¾Œã®è³ªå•ãŒå¤‰ã‚ã‚‹
? Enter the file name pattern of graphql queries, mutations and subscriptions src/graphql/**/*.ts
? Do you want to generate/update all possible GraphQL operations - queries, mutations and subscriptions Yes
? Enter maximum statement depth [increase from default if your schema is deeply nested] 2
? Enter the file name for the generated code src/API.ts
```

Add authenticationã¾ã§åæ˜ ã—ãŸéš›ã®ã‚½ãƒ¼ã‚¹ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
Amplifyã®è¨­å®šã¨ãŸã£ãŸã“ã‚Œã ã‘ã§ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼ã‹ã‚‰GraphQLã¨ã®é€£æºã¾ã§ã§ãã¦ã—ã¾ã†ã®ãŒæã‚ã—ã„ã¨ã“ã‚ã€‚ã€‚ã€‚

```typescript:src/App.tsx
import React, { useEffect, useState } from 'react';
import Amplify, { API, graphqlOperation } from 'aws-amplify';
import { withAuthenticator } from '@aws-amplify/ui-react';
import { createTodo } from 'src/graphql/mutations';
import { listTodos } from 'src/graphql/queries';

import { ListTodosQuery, CreateTodoInput } from 'src/API';

import awsExports from 'src/aws-exports';
import { GraphQLResult } from '@aws-amplify/api';
Amplify.configure(awsExports);

const initialState = { name: '', description: '' };

const App: React.VFC = () => {
  const [formState, setFormState] = useState(initialState);
  const [todos, setTodos] = useState<CreateTodoInput[]>([]);

  useEffect(() => {
    fetchTodos();
  }, []);

  const setInput = (key: string, value: string) => {
    setFormState({ ...formState, [key]: value });
  };

  const fetchTodos = async () => {
    try {
      const todoData = (await API.graphql(
        graphqlOperation(listTodos),
      )) as GraphQLResult<ListTodosQuery>;
      if (todoData.data?.listTodos?.items) {
        const todos = todoData.data.listTodos.items as CreateTodoInput[];
        setTodos(todos);
      }
    } catch (err) {
      console.log('error fetching todos');
    }
  };

  const addTodo = async () => {
    try {
      if (!formState.name || !formState.description) return;
      const todo: CreateTodoInput = { ...formState };
      setTodos([...todos, todo]);
      setFormState(initialState);
      (await API.graphql(
        graphqlOperation(createTodo, { input: todo }),
      )) as GraphQLResult<CreateTodoInput>;
    } catch (err) {
      console.log('error creating todo:', err);
    }
  };
  return (
    <div style={styles.container}>
      <h2>Amplify Todos</h2>
      <input
        onChange={(event) => setInput('name', event.target.value)}
        style={styles.input}
        value={formState.name}
        placeholder="Name"
      />
      <input
        onChange={(event) => setInput('description', event.target.value)}
        style={styles.input}
        value={formState.description}
        placeholder="Description"
      />
      <button style={styles.button} onClick={addTodo}>
        Create Todo
      </button>
      {todos.map((todo, index) => (
        <div key={todo.id ? todo.id : index} style={styles.todo}>
          <p style={styles.todoName}>{todo.name}</p>
          <p style={styles.todoDesctiption}>{todo.description}</p>
        </div>
      ))}
    </div>
  );
};

const styles: {
  [key: string]: React.CSSProperties;
} = {
  container: {
    width: 400,
    margin: '0 auto',
    display: 'flex',
    flexDirection: 'column',
    justifyContent: 'center',
    padding: 20,
  },
  todo: { marginBottom: 15 },
  input: { border: 'none', backgroundColor: '#ddd', marginBottom: 10, padding: 8, fontSize: 18 },
  todoName: { fontSize: 20, fontWeight: 'bold' },
  todoDescription: { marginBottom: 0 },
  button: {
    backgroundColor: 'black',
    color: 'white',
    outline: 'none',
    fontSize: 18,
    padding: '12px 0px',
  },
};

export default withAuthenticator(App);
```

# Hooksã‚’Redux Toolkitã«ç½®ãæ›ãˆã¦ã¿ã‚‹

æ¬¡ã«Reduxã®å­¦ç¿’ã‚’å…¼ã­ã¦Hooksã§ã®çŠ¶æ…‹ç®¡ç†éƒ¨åˆ†ã‚’Redux Toolkitã¸ç½®ãæ›ãˆã¦ã¿ã¾ã—ãŸã€‚
ç·¨é›†ãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ã¯`redux-typescript`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¾ã¾ã«ãªã‚Šã¾ã™ã€‚

```typescript:src/app/store.ts
import { configureStore, ThunkAction, Action } from '@reduxjs/toolkit';
import todoReducer from 'src/features/todo/todoSlice';

export const store = configureStore({
  reducer: {
    todo: todoReducer,
  },
});

export type AppDispatch = typeof store.dispatch;
export type RootState = ReturnType<typeof store.getState>;
export type AppThunk<ReturnType = void> = ThunkAction<
  ReturnType,
  RootState,
  unknown,
  Action<string>
>;
```

```typescript:src/features/todo/todoAPI.ts
// ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§App.tsxã«è¨˜è¼‰ã—ãŸAPIæ¥ç¶šéƒ¨åˆ†ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†é›¢ã—ã¾ã™
import Amplify, { API, graphqlOperation } from 'aws-amplify';
import { createTodo } from 'src/graphql/mutations';
import { listTodos } from 'src/graphql/queries';

import { ListTodosQuery, CreateTodoInput } from 'src/API';

import awsExports from 'src/aws-exports';
import { GraphQLResult } from '@aws-amplify/api';
Amplify.configure(awsExports);

export const fetchTodos = async () => {
  let todos;
  try {
    const todoData = (await API.graphql(
      graphqlOperation(listTodos),
    )) as GraphQLResult<ListTodosQuery>;
    if (todoData.data?.listTodos?.items) {
      todos = todoData.data.listTodos.items as CreateTodoInput[];
    }
  } catch (err) {
    console.log('error fetching todos');
  }

  return todos;
};

export const addTodo = async (formState: { name: string; description: string }) => {
  try {
    if (!formState.name || !formState.description) return;
    const todo: CreateTodoInput = { ...formState };
    (await API.graphql(
      graphqlOperation(createTodo, { input: todo }),
    )) as GraphQLResult<CreateTodoInput>;
  } catch (err) {
    console.log('error creating todo:', err);
  }
};
```

`redux-typescript`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚µãƒ³ãƒ—ãƒ«ã«ã‚ã‚‹`CounterSlice`ã‚’ãƒ™ãƒ¼ã‚¹ã«æ›¸ãæ›ãˆã¦ã„ãã¾ã™ã€‚

```typescript:src/features/todo/todoSlice.ts
import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';
import { RootState } from 'src/app/store';
import { CreateTodoInput } from 'src/API';
import { addTodo, fetchTodos } from './todoAPI';

export type todosState = {
  todos: CreateTodoInput[];
  status: 'idle' | 'loading' | 'failed';
};

const initialState: todosState = {
  todos: [],
  status: 'idle',
};

/**
 * Todoä¸€è¦§ã®å–å¾—
 */

export const fetchAsyncTodos = createAsyncThunk('todo/fetchAsyncTodos', async (_, thunkApi) => {
  const todos = await fetchTodos().catch((error) => {
    throw error;
  });
  if (todos) {
    return todos;
  } else {
    return initialState.todos;
  }
});

/**
 * Todoã®è¿½åŠ 
 */

export const createAsyncTodo = createAsyncThunk(
  'todo/createAsyncTodo',
  async (formState: { name: string; description: string }) => {
    await addTodo(formState).catch((error) => {
      throw error;
    });
    return formState;
  },
);

export const todoSlice = createSlice({
  name: 'todo',
  initialState,
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchAsyncTodos.pending, (state) => {
        state.status = 'loading';
      })
      .addCase(fetchAsyncTodos.fulfilled, (state, action) => {
        state.status = 'idle';
        const data = action.payload.map((post) => {
          return { name: post?.name, description: post.description };
        });
        state.todos = data;
      })
      .addCase(createAsyncTodo.pending, (state) => {
        state.status = 'loading';
      })
      .addCase(createAsyncTodo.fulfilled, (state, action) => {
        state.status = 'idle';
        state.todos.push(action.payload);
      });
  },
});

export const selectTodos = (state: RootState) => state.todo.todos;

export default todoSlice.reducer;
```

App.tsxã¯ã‹ãªã‚Šã™ã£ãã‚Šã§ã™ã€‚

```typescript:src/App.tsx
import React, { useEffect, useState } from 'react';
import { withAuthenticator } from '@aws-amplify/ui-react';
import { useAppDispatch, useAppSelector } from 'src/app/hooks';
import { selectTodos, fetchAsyncTodos, createAsyncTodo } from './features/todo/todoSlice';

const initialState = { name: '', description: '' };

const App: React.VFC = () => {
  const [formState, setFormState] = useState(initialState);
  const todos = useAppSelector(selectTodos);
  const dispatch = useAppDispatch();

  useEffect(() => {
    dispatch(fetchAsyncTodos());
  }, [dispatch]);

  const setInput = (key: string, value: string) => {
    setFormState({ ...formState, [key]: value });
  };

  return (
    <div style={styles.container}>
      <h2>Amplify Todos</h2>
      <input
        onChange={(event) => setInput('name', event.target.value)}
        style={styles.input}
        value={formState.name}
        placeholder="Name"
      />
      <input
        onChange={(event) => setInput('description', event.target.value)}
        style={styles.input}
        value={formState.description}
        placeholder="Description"
      />
      <button
        style={styles.button}
        onClick={() => {
          dispatch(createAsyncTodo(formState));
          setFormState(initialState);
        }}
      >
        Create Todo
      </button>
      {todos.map((todo, index) => (
        <div key={todo.id ? todo.id : index} style={styles.todo}>
          <p style={styles.todoName}>{todo.name}</p>
          <p style={styles.todoDescription}>{todo.description}</p>
        </div>
      ))}
    </div>
  );
};

const styles: {
  [key: string]: React.CSSProperties;
} = {
  container: {
    width: 400,
    margin: '0 auto',
    display: 'flex',
    flexDirection: 'column',
    justifyContent: 'center',
    padding: 20,
  },
  todo: { marginBottom: 15 },
  input: { border: 'none', backgroundColor: '#ddd', marginBottom: 10, padding: 8, fontSize: 18 },
  todoName: { fontSize: 20, fontWeight: 'bold' },
  todoDescription: { marginBottom: 0 },
  button: {
    backgroundColor: 'black',
    color: 'white',
    outline: 'none',
    fontSize: 18,
    padding: '12px 0px',
  },
};

export default withAuthenticator(App);
```

# è‹¦åŠ´ã—ãŸç‚¹

ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã¯JavaScriptã§è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€TypeScriptã«å¤‰æ›´ã™ã‚‹ã«ã¯å„æ‰€ã§å‹ã‚’ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãšã¯ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é€šã‚ŠJavaScriptã§å†™çµŒã—ã¦ã€VS Codeã§ã‚¨ãƒ©ãƒ¼ã®ç®‡æ‰€ã‚’å°‘ã—ãšã¤ä¿®æ­£ã—ã¦ã„ãã¾ã—ãŸã€‚ã¨ãã«GraphQLã®å‹æŒ‡å®šãŒãªã‹ãªã‹ã†ã¾ãã¯ã¾ã‚‰ãšã€ã„ã‚ã„ã‚ãªãƒšãƒ¼ã‚¸ã‚’èª¿ã¹ãªãŒã‚‰è§£æ±ºã€ã‚‚ã—ãã¯`as`å¤šæ§˜ã§ä¹—ã‚Šåˆ‡ã£ã¦ã„ã¾ã™ã€‚ã€‚ã€‚

# ã•ã„ã”ã«

AWS Amplifyã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ä½“é¨“ã™ã‚‹ã ã‘ã§ã‚‚ã€Amplifyã®ä¾¿åˆ©ã•ã‚’ä½“é¨“ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

# å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã‚µã‚¤ãƒˆ

https://zenn.dev/ynakamura/articles/210460b470f7b973e5cc

https://qiita.com/otanu/items/2c522a652e5843a5e2c5

https://qiita.com/aakasaka/items/0b081c90b1b99b82143c
